# MSA 설계 보고서

---

## 1. 프로젝트 개요
- **프로젝트명** : 콘서트 예약 서비스
- **기존 구조** : Monolithic
- **목표** : 규모가 확장되어 각 도메인 별로 분리 및 트랜잭션 관리를 위해 MSA 로 전환합니다.

## 2. 주요 기능
- 콘서트 조회
- 스케줄 조회
- 좌석 조회
- 예약
- 회원 포인트 조회 및 충전
- 결제
- 대기열

## 3. 현재 문제점
- 하나의 DB에 모든 테이블 집중합니다.
- 기능 간 강결합 합니다
- 장애 발생 시 전체 서비스 중단 위험이 있습니다.

## 4. 트랜잭션 관리: Saga Pattern - Choreography 선택

### 4-1) Saga Pattern이란?
Saga Pattern 은 분산 트랜잭션을 관리하는 패턴으로 MSA 구조에서 하나의 요청이 여러 도메인 서비스의 데이터베이스에 처리됨에 따라 한번에 커밋하거나 롤백이 불가능한 상황을 극복하기 위한 패턴을 말합니다.

각 도메인 서비스가 자체적인 트랜잭션을 갖더라도 전체 흐름에서 하나의 논리적인 트랜잭션으로 동작하도록 구성해야 합니다.

### 4-2) Choreography란?
Saga Pattern 의 대표적인 2가지 중 하나로서 각 서비스들이 이벤트 기반으로 동작하는 형태로 구성됩니다.

### 4-3) 보상 트랜잭션이란?
보상 트랜잭션이란, 물리적 개념이 아니라 롤백된 것처럼 비즈니스적으로 롤백 처리하는 것을 의미합니다.
예시로 A -> B 순서로 작업이 진행됩니다. A는 성공했지만 B에서 실패하면 A의 작업 결과를 되돌리지 않고
status 같은 필드를 둬서 "success" > "canceled"로 변경하는 것입니다.

### 4-4) Choreography의 장점과 단점
- **장점**
  - 마이크로 서비스가 적다면 간단하게 구성 가능합니다.
  - 중앙 관리형이 아니기 때문에, 하나의 서비스에 문제가 발생해도 다른 서비스에 영향이 적습니다.
- **단점**
  - 마이크로 서비스가 많아진다면 이벤트 구조를 파악하기 어렵습니다.
  - 서비스간 순환 종속이 발생할 수 있습니다.

### 4-5) 예상도
![msa_design_image](https://github.com/user-attachments/assets/7d6f6597-248b-477a-9ae2-b70d0341f726)
